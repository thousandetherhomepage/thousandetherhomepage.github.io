(window.webpackJsonp=window.webpackJsonp||[]).push([[18,5,19],{323:function(e,t,r){"use strict";var n=r(5),o=r(331);n({target:"String",proto:!0,forced:r(332)("link")},{link:function(e){return o(this,"a","href",e)}})},324:function(e,t,r){"use strict";r.r(t);r(323),r(61),r(163),r(334);var n={props:["ad","showNSFW","skipImage"],data:function(){return{blank:!1,brokenImage:""}},computed:{shown:function(){return!this.ad.NSFW||this.showNSFW},link:function(){return this.shown?this.ad.link&&function(link){var e=link.trim().toLowerCase();return!!(e.startsWith("javascript:")||e.startsWith("data:")||e.startsWith("file:"))}(this.ad.link)?"":this.ad.link:""},title:function(){return this.shown?this.ad.title:"NSFW hidden"},image:function(){if(!this.shown)return"";var e=function(e){var u=e.trim().toLowerCase();if(!u)return"";if(u.startsWith("bzz://"))e="http://swarm-gateways.net/bzz:/"+e.slice(6);else if(u.startsWith("ipfs://"))e="https://gateway.ipfs.io/ipfs/"+e.slice(7);else if(u.startsWith("https://gateway.pinata.cloud/ipfs/"))e="https://gateway.ipfs.io/ipfs/"+e.slice(34);else if(u.startsWith("file:"))return"";return e}(this.ad.image);return""===e||e==this.brokenImage?(this.blank=!0,this.ad.title?e:"/broken-image.png"):e},style:function(){return function(e,t){if(!e.width)return{display:"none"};var s={left:10*e.x+"px",top:10*e.y+"px",width:10*e.width+"px",height:10*e.height+"px"};return t||!e.image?s.background="#"+e.owner.slice(-6)+"cc":s.background="#fff",s}(this.ad,this.blank)},classMap:function(){return{nsfwAd:!this.shown,blank:this.blank}}},methods:{setBroken:function(e){this.brokenImage=e.target.src}}},o=r(60),component=Object(o.a)(n,(function(){var e=this,t=e._self._c;return t("a",{attrs:{href:e.link,target:"_blank","data-idx":e.ad.idx}},[e.skipImage?t("div",{class:e.classMap,style:e.style,attrs:{title:e.title}}):t("img",{class:e.classMap,style:e.style,attrs:{src:e.image,title:e.title},on:{error:e.setBroken}})])}),[],!1,null,null,null);t.default=component.exports},331:function(e,t,r){"use strict";var n=r(7),o=r(27),d=r(18),l=/"/g,c=n("".replace);e.exports=function(e,t,r,n){var h=d(o(e)),v="<"+t;return""!==r&&(v+=" "+r+'="'+c(d(n),l,"&quot;")+'"'),v+">"+h+"</"+t+">"}},332:function(e,t,r){"use strict";var n=r(6);e.exports=function(e){return n((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},334:function(e,t,r){"use strict";var n=r(5),o=r(234).trim;n({target:"String",proto:!0,forced:r(339)("trim")},{trim:function(){return o(this)}})},339:function(e,t,r){"use strict";var n=r(102).PROPER,o=r(6),d=r(235);e.exports=function(e){return o((function(){return!!d[e]()||"​᠎"!=="​᠎"[e]()||n&&d[e].name!==e}))}},356:function(e,t,r){var content=r(385);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(126).default)("03a3719c",content,!0,{sourceMap:!1})},384:function(e,t,r){"use strict";r(356)},385:function(e,t,r){var n=r(125)((function(i){return i[1]}));n.push([e.i,"label{display:block;margin-bottom:.5em}label span{display:inline-block;min-width:6em}input{width:200px}.wrapAd{border-left:10px solid #eee;padding-left:10px;width:700px}.wrapAd .previewAd img{color:rgba(0,0,0,.7);display:block;font-size:11px;overflow:hidden;white-space:nowrap}.wrapAd small{color:#966;display:inline-block;margin:.5em}.wrapAd button{background:#fff8db;border-width:2px;display:block;font-size:1em;padding:5px}.wrapAd label{line-height:2em}.wrapAd label button{display:inline-block;margin-right:.25em}.wrapAd .mini-adGrid{background:#ddd;margin-bottom:1em;padding:10px}",""]),n.locals={},e.exports=n},416:function(e,t,r){var content=r(522);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(126).default)("2906e77c",content,!0,{sourceMap:!1})},426:function(e,t,r){"use strict";r.r(t);var n=r(9),o=(r(62),{props:["provider","contract","ketherNFT","ad"],data:function(){return{error:null,wrapInProgress:""}},methods:{wrap:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,d,l,c,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.provider.getSigner();case 2:return r=t.sent,t.next=5,r.getAddress();case 5:return n=t.sent,t.prev=6,t.next=9,e.ketherNFT.precompute(e.ad.idx,n);case 9:if(o=t.sent,o.salt,42==(d=o.predictedAddress).length&&"0x0000000000000000000000000000000000000000"!=d){t.next=14;break}throw"Invalid predictedAddress, something is wrong: "+d;case 14:if(l=e.$store.getters.precomputeEscrow({idx:e.ad.idx,KH:e.contract,KNFT:e.ketherNFT}),e.$address.equal(d,l)){t.next=17;break}throw"predictedAddress does not match expected value, something went wrong: "+d+" != "+l;case 17:return e.wrapInProgress="Fetching latest state...",t.t0=e.$address,t.next=21,e.contract.ads(e.ad.idx);case 21:if(t.t1=t.sent.owner,t.t2=d,!t.t0.equal.call(t.t0,t.t1,t.t2)){t.next=27;break}e.$store.commit("addHalfWrapped",{idx:e.ad.idx,account:n}),t.next=36;break;case 27:if(e.$store.state.halfWrapped[e.ad.idx]){t.next=36;break}return e.wrapInProgress="Check your wallet for queued transactions, there will be 2 in total.",t.next=31,e.contract.connect(r).setAdOwner(e.ad.idx,d);case 31:return c=t.sent,e.wrapInProgress="First transaction submitted, waiting... (This can take a few minutes)",t.next=35,c.wait();case 35:e.$store.commit("addHalfWrapped",{idx:e.ad.idx,account:n});case 36:return t.t3=e.$address,t.next=39,e.contract.ads(e.ad.idx);case 39:if(t.t4=t.sent.owner,t.t5=e.ketherNFT.address,t.t3.equal.call(t.t3,t.t4,t.t5)){t.next=49;break}return e.wrapInProgress="Confirm 2nd wrap transaction, check your wallet queue.",t.next=45,e.ketherNFT.connect(r).wrap(e.ad.idx,n);case 45:return h=t.sent,e.wrapInProgress="Second transaction submitted, waiting...",t.next=49,h.wait();case 49:e.$store.commit("updateAds",[{idx:e.ad.idx,update:{owner:n,wrapped:!0}}]),e.$store.commit("removeHalfWrapped",e.ad.idx),e.$emit("refresh",{idx:e.ad.idx}),e.error=null,t.next=58;break;case 55:t.prev=55,t.t6=t.catch(6),e.error=t.t6;case 58:return t.prev=58,e.wrapInProgress=!1,t.finish(58);case 61:case"end":return t.stop()}}),t,null,[[6,55,58,61]])})))()},unwrap:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.provider.getSigner();case 2:return r=t.sent,t.next=5,r.getAddress();case 5:return n=t.sent,t.prev=6,t.t0=e.$address,t.next=10,e.contract.ads(e.ad.idx);case 10:if(t.t1=t.sent.owner,t.t2=e.ketherNFT.address,!t.t0.equal.call(t.t0,t.t1,t.t2)){t.next=19;break}return t.next=15,e.ketherNFT.connect(r).unwrap(e.ad.idx,n);case 15:return o=t.sent,e.wrapInProgress="Unwrapping transaction submitted, waiting...",t.next=19,o.wait();case 19:e.$store.commit("updateAds",[{idx:e.ad.idx,update:{wrapped:!1}}]),e.$emit("refresh",{idx:e.ad.idx}),e.error=null,t.next=27;break;case 24:t.prev=24,t.t3=t.catch(6),e.error=t.t3;case 27:return t.prev=27,e.wrapInProgress=!1,t.finish(27);case 30:case"end":return t.stop()}}),t,null,[[6,24,27,30]])})))()}}}),d=(r(384),r(60)),component=Object(d.a)(o,(function(){var e=this,t=e._self._c;return t("div",[t("form",{staticClass:"wrapAd",on:{submit:function(e){e.preventDefault()}}},[t("h3",[e._v("NFT")]),e._v(" "),e.wrapInProgress?t("p",{staticClass:"progress"},[t("img",{staticStyle:{width:"32px",height:"18px","vertical-align":"text-bottom"},attrs:{src:"/throbber.svg",alt:"⏳"}}),e._v(" "),t("strong",[e._v("Transaction in progress.")]),e._v(" "),t("span",[e._v(e._s(e.wrapInProgress))])]):e._e(),e._v(" "),e.ad.wrapped?t("p",[e._v("\n    Ad is wrapped to NFT.\n    "),t("button",{attrs:{type:"button",disabled:!!e.wrapInProgress},on:{click:e.unwrap}},[e._v("Unwrap #"+e._s(e.ad.idx)+" to Legacy Contract")])]):e.$store.state.halfWrapped[e.ad.idx]?t("p",[t("label",[t("button",{attrs:{type:"button",disabled:!!e.wrapInProgress},on:{click:e.wrap}},[e._v("Finish Wrapping #"+e._s(e.ad.idx)+" to NFT")]),e._v(" "),t("small",[e._v("Complete the wrapping of this ad as NFT")])])]):t("p",[t("label",[t("button",{attrs:{type:"button",disabled:!!e.wrapInProgress},on:{click:e.wrap}},[e._v("Wrap #"+e._s(e.ad.idx)+" to NFT")]),e._v(" "),t("small",[e._v("Queue up 2 on-chain transactions, roughly 31,249 + 231,727 gas = 0.0262 ETH at 100 gwei")])])])]),e._v(" "),e.error?t("p",{staticClass:"error"},[e._v("\n    "+e._s(e.error)+"\n  ")]):e._e()])}),[],!1,null,null,null);t.default=component.exports},521:function(e,t,r){"use strict";r(416)},522:function(e,t,r){var n=r(125)((function(i){return i[1]}));n.push([e.i,"label{display:block;margin-bottom:.5em}label span{display:inline-block;min-width:6em}input{width:200px}.editAd{border-left:10px solid #eee;padding-left:10px}.editAd .previewAd img{color:rgba(0,0,0,.7);display:block;font-size:11px;overflow:hidden;white-space:nowrap}.editAd small{color:#966;display:inline-block;margin:.5em}.editAd button{background:#fff8db;border-width:2px;display:block;font-size:1em;padding:5px}.editAd .mini-adGrid{background:#ddd;margin-bottom:1em;padding:10px}",""]),n.locals={},e.exports=n},559:function(e,t,r){"use strict";r.r(t);r(127),r(61),r(323);var n=r(9),o=(r(62),r(165),r(324)),d=r(426),l={props:["ad","provider","contract","ketherNFT","ketherPublisher","asPublisher","showNSFW"],data:function(){return{canPublish:!0,warnings:[],inProgress:!1,error:null}},watch:{ad:function(){this.canPublish=!0,this.warnings=[]}},methods:{checkImage:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,d,l,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],n=e.$refs.adPreview.$el.children[0],o=20*e.ad.width,d=20*e.ad.height,l=o*d*2,n.naturalWidth>o&&r.push("Image is too wide: Width is ".concat(n.naturalWidth,"px but it should be ").concat(o/2,"px (or ").concat(o,"px for HiDPI).")),n.naturalHeight>d&&r.push("Image is too tall: Height is ".concat(n.naturalHeight,"px but it should be ").concat(d/2,"px (or ").concat(d,"px for HiDPI).")),n.naturalWidth/n.naturalHeight!=o/d&&r.push("Image aspect ratio is incorrect, it will appear squished and blurry."),(c=n.naturalWidth*n.naturalHeight>l)&&r.push("Image is way too big. Please resize to ".concat(o,"x").concat(d,"px or smaller before publishing.")),e.canPublish=!c,e.warnings=r;case 12:case"end":return t.stop()}}),t)})))()},publish:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o,d,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkImage();case 2:if(e.canPublish){t.next=4;break}return t.abrupt("return");case 4:return r=e.ad,t.next=7,e.provider.getSigner();case 7:return n=t.sent,t.next=10,n.getAddress();case 10:if(o=t.sent,e.asPublisher||o.toLowerCase()==r.owner){t.next=14;break}return e.error="Incorrect active wallet. Must publish with: "+r.owner,t.abrupt("return");case 14:return e.inProgress="Waiting for wallet to confirm.",t.t0=e.$address,t.next=18,e.contract.ads(r.idx);case 18:if(t.t1=t.sent.owner,t.t2=e.ketherNFT.address,d=t.t0.equal.call(t.t0,t.t1,t.t2),t.prev=21,!e.asPublisher||o.toLowerCase()==r.owner){t.next=33;break}return t.next=25,e.ketherPublisher.isApprovedToPublish(o,r.idx);case 25:if(t.sent){t.next=28;break}throw"KetherNFTPublisher: Signer is not approved to publish to this ad: "+r.idx;case 28:return t.next=30,e.ketherPublisher.connect(n).publish(r.idx,r.link,r.image,r.title,Number(r.NSFW));case 30:l=t.sent,t.next=42;break;case 33:if(!d){t.next=39;break}return t.next=36,e.ketherNFT.connect(n).publish(r.idx,r.link,r.image,r.title,Number(r.NSFW));case 36:l=t.sent,t.next=42;break;case 39:return t.next=41,e.contract.connect(n).publish(r.idx,r.link,r.image,r.title,Number(r.NSFW));case 41:l=t.sent;case 42:return e.inProgress="Submitted, waiting...",t.next=45,l.wait();case 45:e.inProgress=!1,t.next=52;break;case 48:return t.prev=48,t.t3=t.catch(21),e.error=t.t3,t.abrupt("return");case 52:return t.prev=52,e.inProgress=!1,t.finish(52);case 55:return t.abrupt("return",!1);case 56:case"end":return t.stop()}}),t,null,[[21,48,52,55]])})))()}},components:{Ad:o.default,Wrap:d.default}},c=(r(521),r(60)),component=Object(c.a)(l,(function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"adPublish"}},[t("form",{on:{submit:[e.publish,function(e){e.preventDefault()}]}},[t("div",{staticClass:"editAd"},[t("h3",[e._v("Publish Changes")]),e._v(" "),e.asPublisher?t("p",[t("strong",{staticStyle:{color:"purple"}},[e._v("Editing as delegated publisher")])]):e._e(),e._v(" "),t("p",[e._v("\n        What do you want your ad to look like? Some rules:\n      ")]),e._v(" "),e._m(0),e._v(" "),t("label",[t("span",[e._v("Idx")]),e._v(" "),t("input",{attrs:{type:"text",disabled:""},domProps:{value:e.ad.idx}})]),e._v(" "),t("label",[t("span",[e._v("Title")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.ad.title,expression:"ad.title"}],attrs:{type:"text",placeholder:"Come visit MyCorp"},domProps:{value:e.ad.title},on:{input:function(t){t.target.composing||e.$set(e.ad,"title",t.target.value)}}})]),e._v(" "),t("label",[t("span",[e._v("Link")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.ad.link,expression:"ad.link"}],attrs:{type:"text",placeholder:"https://..."},domProps:{value:e.ad.link},on:{input:function(t){t.target.composing||e.$set(e.ad,"link",t.target.value)}}}),e._v(" "),e.ad.link&&-1===e.ad.link.indexOf("://")?t("small",{staticClass:"error"},[e._v("Missing https://?")]):e._e()]),e._v(" "),t("label",[t("span",[e._v("Image")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.ad.image,expression:"ad.image"}],attrs:{type:"text",placeholder:"https://...."},domProps:{value:e.ad.image},on:{change:e.checkImage,input:function(t){t.target.composing||e.$set(e.ad,"image",t.target.value)}}}),e._v(" "),e._m(1)]),e._v(" "),t("label",[t("span",[e._v("NSFW")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.ad.NSFW,expression:"ad.NSFW"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.ad.NSFW)?e._i(e.ad.NSFW,null)>-1:e.ad.NSFW},on:{change:function(t){var r=e.ad.NSFW,n=t.target,o=!!n.checked;if(Array.isArray(r)){var d=e._i(r,null);n.checked?d<0&&e.$set(e.ad,"NSFW",r.concat([null])):d>-1&&e.$set(e.ad,"NSFW",r.slice(0,d).concat(r.slice(d+1)))}else e.$set(e.ad,"NSFW",o)}}}),e._v(" "),e.ad.forceNSFW?t("strong",[e._v("Forced NSFW by moderator")]):e._e()]),e._v(" "),t("div",[e._m(2),e._v(" "),t("div",{staticClass:"mini-adGrid"},[t("Ad",{ref:"adPreview",staticClass:"previewAd",attrs:{showNSFW:e.showNSFW,ad:e.ad}})],1)]),e._v(" "),e.warnings.length>0?t("ul",e._l(e.warnings,(function(r){return t("li",{key:r},[e._v("⚠️ "+e._s(r))])})),0):e._e(),e._v(" "),t("div",[t("button",{attrs:{type:"submit",disabled:!e.canPublish}},[e._v("Publish Changes")])]),e._v(" "),e.inProgress?t("p",{staticClass:"progress"},[t("img",{staticStyle:{width:"32px",height:"18px","vertical-align":"text-bottom"},attrs:{src:"/throbber.svg",alt:"⏳"}}),e._v(" "),t("strong",[e._v("Transaction in progress.")]),e._v(" "),t("span",[e._v(e._s(e.inProgress))])]):e._e(),e._v(" "),t("small",[e._v("\n        It can take between 10 seconds to a few minutes for your published ad\n        to get mined into the blockchain and show up. The fees are paid to miners\n        to get the changes into the next block.\n      ")])])]),e._v(" "),e.error?t("p",{staticClass:"error"},[e._v("\n    "+e._s(e.error)+"\n  ")]):e._e()])}),[function(){var e=this,t=e._self._c;return t("ul",[t("li",[e._v("If your ad contains adult content, please self-mark it as NSFW. NSFW ads are opt-in by viewers. You can change it later if you self-mark as NSFW.")]),e._v(" "),t("li",[e._v("Don't link to, or put, inappropriate or illegal content in the ad.")]),e._v(" "),t("li",[t("strong",[e._v("Keep your image size small, under 100KB.")]),e._v(" PNG is preferred, but JPG or non-animated GIF is acceptable.")]),e._v(" "),t("li",[e._v("If your ad breaks any rules, it can be forced to NSFW by the moderators of this contract and then only a moderator can change it back to non-NSFW.")])])},function(){var e=this,t=e._self._c;return t("small",[e._v("URL to PNG image. Preferably "),t("code",[e._v("ipfs://")]),e._v(" or "),t("code",[e._v("data:image/png,base64,...")]),e._v(" encoded. Can be "),t("code",[e._v("https://")]),e._v(" but "),t("strong",[e._v("do not hotlink")]),e._v(" because they tend to break. Link to an actual image, not a website containing it. "),t("br"),e._v("Must be less than 100KB.")])},function(){var e=this,t=e._self._c;return t("h3",[e._v("Preview "),t("small",[e._v("(not published yet)")])])}],!1,null,null,null);t.default=component.exports;installComponents(component,{Ad:r(324).default})}}]);